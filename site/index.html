<!DOCTYPE html>
<html>
    <!-- made by j.smith and j. smith -->
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="toons.css">
        <title>TOONS!</title>
        <script type"text/javascript" src="update.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            // Global Variables
            var name    = "TEST";
            var series  = null;
            var length  = 0;
            var index   = 0;

            // Update what the user sees
            function update()
            {
                if(null === series)
                {
                    document.getElementById("title").innerHTML      = "<h1>Coming soon...</h1>";
                    document.getElementById("first").disabled       = true;
                    document.getElementById("previous").disabled    = true;
                    document.getElementById("about").disabled       = true;
                    document.getElementById("next").disabled        = true;
                    document.getElementById("last").disabled        = true;
                    document.getElementById("meta").innerHTML       = "<h1>Coming soon...</h1>";
                    document.getElementById("view").innerHTML       = "<h1>Coming soon...</h1>";
                    return;
                }
            
                var episode = series["episodes"][index];
                document.getElementById("title").innerHTML      = "<h1>" + series["meta"]["title"] + "</h1>";
                document.getElementById("first").disabled       = false;
                document.getElementById("previous").disabled    = (index <= 1);
                document.getElementById("about").disabled       = false;
                document.getElementById("next").disabled        = index >= (length - 1);
                document.getElementById("last").disabled        = false;
                
                document.getElementById("meta").innerHTML       = "Episode #" + episode["number"] + "<h1>" + episode["story"] + " - Part " + episode["part"] + "</h1>";
                document.getElementById("view").innerHTML       = "<p>"  + episode["notes"] + "</p><img src=\"" + name + "/episodes/" + name + "_" + episode["number"] + ".jpg\">";
            }

            // First button pressed
            function updateToFirst()
            {
                if(!(null === series))
                {
                    index   = 1;
                }
                update();
            }

            // Previous button pressed
            function updateToPrevious()
            {
                if(!(null === series) && (index > 1))
                {
                    index   = index - 1;
                }
                update();
            }

            // About button pressed
            function updateToAbout()
            {
//                 update();
                document.getElementById("meta").innerHTML       = series["meta"]["about"];
            }

            // Next button pressed
            function updateToNext()
            {
                if(!(null === series) && (index < (length - 1)))
                {
                    index   = index + 1;
                }
                update();
            }

            // Last button pressed
            function updateToLast()
            {
                if(!(null === series))
                {
                    index   = length - 1;
                }
                update();
            }

            // Get series data from the server, update global variables, and update()
            function getData()
            {
                var file    = name + "/" + name + ".json";
                var xhttp   = new XMLHttpRequest();
                xhttp.onreadystatechange = function()
                {
                    if (this.readyState == 4 && this.status == 200)
                    {
                    series  = JSON.parse(this.responseText);

                    // TODO: Error checking
                    length  = series["episodes"].length;
                    index   = length - 1;
                    
                    update();
                    }
                };
                xhttp.open("GET", file, true);
                xhttp.send();
            }
					  
        // See end of body tag for running the page
        </script>
        <div id="controls">
            <h1 id="title">Coming Soon...</h1>
            <button type="button" class="nav" id="first"    onclick="updateToFirst()"       disabled>First</button>
            <button type="button" class="nav" id="previous" onclick="updateToPrevious()"    disabled>Prev</button>
            <button type="button" class="nav" id="about"    onclick="updateToAbout()"       disabled>About</button>
            <button type="button" class="nav" id="next"     onclick="updateToNext()"        disabled>Next</button>
            <button type="button" class="nav" id="last"     onclick="updateToLast()"        disabled>Last</button>
        </div>		
        <hr>
        <div class="data" id="meta">
            Initial meta.
        </div>
        <div class="data" id="view">
            Initial view.
        </div>
        <script type="text/javascript">
            // Run the page...
            update();   // to a consistent state
            getData();  // to use, which will update() when ready
        </script>
    </body>
</html>
